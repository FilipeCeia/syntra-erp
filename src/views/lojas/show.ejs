<!-- Detalhes da Loja -->
<div class="container-fluid">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/lojas">Lojas</a></li>
          <li class="breadcrumb-item active"><%= loja.nome %></li>
        </ol>
      </nav>
      <h1 class="h3 mb-0 text-gray-800"><%= loja.nome %></h1>
      <p class="mb-0 text-muted">Código: <%= loja.codigo %> | Status: 
        <span class="badge badge-<%= loja.status === 'Ativa' ? 'success' : loja.status === 'Inativa' ? 'danger' : 'warning' %>">
          <%= loja.status %>
        </span>
      </p>
    </div>
    <div>
      <a href="/lojas/<%= loja.id %>/edit" class="btn btn-primary">
        <i class="fas fa-edit"></i> Editar Loja
      </a>
      <button class="btn btn-outline-secondary" onclick="window.print()">
        <i class="fas fa-print"></i> Imprimir
      </button>
    </div>
  </div>

  <!-- Informações Básicas -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Informações da Loja</h6>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label text-muted">Nome da Loja</label>
                <div class="font-weight-bold"><%= loja.nome %></div>
              </div>
              <div class="mb-3">
                <label class="form-label text-muted">Endereço</label>
                <div><%= loja.endereco %></div>
              </div>
              <div class="mb-3">
                <label class="form-label text-muted">Telefone</label>
                <div><%= loja.telefone %></div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label class="form-label text-muted">Email</label>
                <div><%= loja.email %></div>
              </div>
              <div class="mb-3">
                <label class="form-label text-muted">Gerente</label>
                <div><%= loja.gerente %></div>
              </div>
              <div class="mb-3">
                <label class="form-label text-muted">Data de Abertura</label>
                <div><%= loja.data_abertura.toLocaleDateString('pt-PT') %></div>
              </div>
            </div>
          </div>
          <% if (loja.observacoes) { %>
          <div class="mb-3">
            <label class="form-label text-muted">Observações</label>
            <div><%= loja.observacoes %></div>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <!-- Estatísticas Rápidas -->
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Estatísticas</h6>
        </div>
        <div class="card-body">
          <div class="text-center mb-3">
            <div class="h4 font-weight-bold text-primary"><%= estatisticas.funcionarios %></div>
            <div class="small text-gray-500">Funcionários Ativos</div>
          </div>
          <hr>
          <div class="text-center mb-3">
            <div class="h4 font-weight-bold text-success"><%= estatisticas.vendas_mes.toLocaleString('pt-MZ', {style: 'currency', currency: 'MZN'}) %></div>
            <div class="small text-gray-500">Vendas Este Mês</div>
          </div>
          <hr>
          <div class="text-center mb-3">
            <div class="h4 font-weight-bold text-info"><%= estatisticas.meta_mensal.toLocaleString('pt-MZ', {style: 'currency', currency: 'MZN'}) %></div>
            <div class="small text-gray-500">Meta Mensal</div>
          </div>
          <hr>
          <div class="text-center">
            <div class="h4 font-weight-bold text-<%= estatisticas.percentual_meta >= 100 ? 'success' : estatisticas.percentual_meta >= 80 ? 'warning' : 'danger' %>">
              <%= estatisticas.percentual_meta.toFixed(1) %>%
            </div>
            <div class="small text-gray-500">% da Meta Atingida</div>
          </div>
        </div>
      </div>

      <!-- Ações Rápidas -->
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Ações Rápidas</h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary btn-sm" onclick="novoFuncionario()">
              <i class="fas fa-user-plus"></i> Novo Funcionário
            </button>
            <button class="btn btn-outline-success btn-sm" onclick="novaTransferencia()">
              <i class="fas fa-exchange-alt"></i> Nova Transferência
            </button>
            <button class="btn btn-outline-info btn-sm" onclick="verRelatorios()">
              <i class="fas fa-chart-bar"></i> Ver Relatórios
            </button>
            <button class="btn btn-outline-warning btn-sm" onclick="gerenciarEstoque()">
              <i class="fas fa-boxes"></i> Gerenciar Estoque
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Performance Mensal -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Performance dos Últimos 6 Meses</h6>
        </div>
        <div class="card-body">
          <div class="chart-area">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card shadow mb-4">
        <div class="card-header py-3">
          <h6 class="m-0 font-weight-bold text-primary">Top Produtos</h6>
        </div>
        <div class="card-body">
          <% top_produtos.forEach((produto, index) => { %>
          <div class="d-flex align-items-center <%= index < top_produtos.length - 1 ? 'border-bottom' : '' %> py-2">
            <div class="mr-3">
              <div class="icon-circle bg-primary">
                <span class="text-white font-weight-bold"><%= index + 1 %></span>
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="font-weight-bold"><%= produto.nome %></div>
              <div class="small text-gray-500"><%= produto.quantidade %> vendidos</div>
            </div>
            <div class="text-right">
              <div class="font-weight-bold"><%= produto.valor.toLocaleString('pt-MZ', {style: 'currency', currency: 'MZN'}) %></div>
            </div>
          </div>
          <% }); %>
        </div>
      </div>
    </div>
  </div>

  <!-- Funcionários da Loja -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
      <h6 class="m-0 font-weight-bold text-primary">Funcionários (<%= funcionarios.length %>)</h6>
      <a href="/lojas/funcionarios?loja_id=<%= loja.id %>" class="btn btn-sm btn-primary">
        Ver Todos
      </a>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered" width="100%" cellspacing="0">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Cargo</th>
              <th>Email</th>
              <th>Telefone</th>
              <th>Data Admissão</th>
              <th>Salário</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% if (funcionarios.length > 0) { %>
              <% funcionarios.forEach(funcionario => { %>
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="mr-3">
                      <div class="icon-circle bg-<%= funcionario.cargo === 'Gerente' ? 'primary' : funcionario.cargo === 'Vendedor' ? 'success' : 'info' %>">
                        <i class="fas fa-user text-white"></i>
                      </div>
                    </div>
                    <div>
                      <div class="font-weight-bold"><%= funcionario.nome %></div>
                    </div>
                  </div>
                </td>
                <td><%= funcionario.cargo %></td>
                <td><%= funcionario.email %></td>
                <td><%= funcionario.telefone %></td>
                <td><%= funcionario.data_admissao.toLocaleDateString('pt-PT') %></td>
                <td><%= funcionario.salario.toLocaleString('pt-MZ', {style: 'currency', currency: 'MZN'}) %></td>
                <td>
                  <span class="badge badge-<%= funcionario.status === 'Ativo' ? 'success' : 'danger' %>">
                    <%= funcionario.status %>
                  </span>
                </td>
              </tr>
              <% }); %>
            <% } else { %>
              <tr>
                <td colspan="7" class="text-center py-4">
                  <i class="fas fa-users fa-3x text-gray-300 mb-3"></i><br>
                  <span class="text-muted">Nenhum funcionário cadastrado</span>
                </td>
              </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Transferências Recentes -->
  <div class="card shadow mb-4">
    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
      <h6 class="m-0 font-weight-bold text-primary">Transferências Recentes</h6>
      <a href="/lojas/transferencias?loja_id=<%= loja.id %>" class="btn btn-sm btn-primary">
        Ver Todas
      </a>
    </div>
    <div class="card-body">
      <% if (transferencias_recentes.length > 0) { %>
        <% transferencias_recentes.forEach(transferencia => { %>
        <div class="d-flex align-items-center border-bottom py-3">
          <div class="mr-3">
            <div class="icon-circle bg-<%= transferencia.tipo === 'Produtos' ? 'primary' : 'success' %>">
              <i class="fas fa-<%= transferencia.tipo === 'Produtos' ? 'exchange-alt' : 'user-friends' %> text-white"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <div class="font-weight-bold"><%= transferencia.codigo %></div>
            <div class="small text-gray-500">
              <%= transferencia.origem %> → <%= transferencia.destino %>
            </div>
            <div class="small"><%= transferencia.detalhes %></div>
          </div>
          <div class="text-right">
            <div class="small text-gray-500"><%= transferencia.data.toLocaleDateString('pt-PT') %></div>
            <div>
              <span class="badge badge-<%= transferencia.status === 'Concluída' ? 'success' : transferencia.status === 'Pendente' ? 'warning' : 'info' %>">
                <%= transferencia.status %>
              </span>
            </div>
          </div>
        </div>
        <% }); %>
      <% } else { %>
        <div class="text-center py-4">
          <i class="fas fa-exchange-alt fa-3x text-gray-300 mb-3"></i><br>
          <span class="text-muted">Nenhuma transferência recente</span>
        </div>
      <% } %>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Gráfico de Performance
const ctx = document.getElementById('performanceChart').getContext('2d');
const performanceChart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: <%= JSON.stringify(performance_mensal.map(p => p.mes)) %>,
    datasets: [{
      label: 'Vendas',
      data: <%= JSON.stringify(performance_mensal.map(p => p.vendas)) %>,
      borderColor: 'rgba(78, 115, 223, 1)',
      backgroundColor: 'rgba(78, 115, 223, 0.1)',
      borderWidth: 2,
      fill: true
    }, {
      label: 'Meta',
      data: <%= JSON.stringify(performance_mensal.map(p => p.meta)) %>,
      borderColor: 'rgba(28, 200, 138, 1)',
      backgroundColor: 'rgba(28, 200, 138, 0.1)',
      borderWidth: 2,
      borderDash: [5, 5],
      fill: false
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          callback: function(value) {
            return value.toLocaleString('pt-MZ', {style: 'currency', currency: 'MZN'});
          }
        }
      }
    },
    plugins: {
      legend: {
        position: 'top'
      }
    }
  }
});

function novoFuncionario() {
  window.location.href = '/lojas/funcionarios/create?loja_id=<%= loja.id %>';
}

function novaTransferencia() {
  window.location.href = '/lojas/transferencias/create?loja_origem_id=<%= loja.id %>';
}

function verRelatorios() {
  window.location.href = '/lojas/relatorios?loja_id=<%= loja.id %>';
}

function gerenciarEstoque() {
  alert('Funcionalidade de gestão de estoque em desenvolvimento');
}
</script>